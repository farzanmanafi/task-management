<!-- Create this file as: admin-ui/index.html -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Management Admin</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        font-family:
          'Inter',
          -apple-system,
          BlinkMacSystemFont,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .glass {
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.18);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      function AdminDashboard() {
        const [data, setData] = useState(null);
        const [users, setUsers] = useState([]);
        const [tasks, setTasks] = useState([]);
        const [projects, setProjects] = useState([]);
        const [currentView, setCurrentView] = useState('dashboard');
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);
        const [isAuthenticated, setIsAuthenticated] = useState(false);
        const [loginForm, setLoginForm] = useState({
          email: 'admin@taskmanagement.com',
          password: 'admin123',
        });

        useEffect(() => {
          const token = localStorage.getItem('authToken');
          if (token) {
            setIsAuthenticated(true);
            fetchDashboardData();
          } else {
            setLoading(false);
          }
        }, []);

        const apiCall = async (endpoint, options = {}) => {
          const token = localStorage.getItem('authToken');
          const response = await fetch(endpoint, {
            ...options,
            headers: {
              Authorization: `Bearer ${token}`,
              'Content-Type': 'application/json',
              ...options.headers,
            },
          });

          if (!response.ok) {
            if (response.status === 401) {
              localStorage.removeItem('authToken');
              setIsAuthenticated(false);
              throw new Error('Authentication required');
            }
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          return response.json();
        };

        const login = async () => {
          try {
            const response = await fetch('/api/v1/auth/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                usernameOrEmail: loginForm.email,
                password: loginForm.password,
              }),
            });

            const result = await response.json();

            if (result.success) {
              localStorage.setItem('authToken', result.data.accessToken);
              setIsAuthenticated(true);
              setError(null);
              await fetchDashboardData();
            } else {
              setError(result.message || 'Login failed');
            }
          } catch (err) {
            setError('Login failed: ' + err.message);
          }
        };

        const logout = () => {
          localStorage.removeItem('authToken');
          setIsAuthenticated(false);
          setData(null);
          setUsers([]);
          setTasks([]);
          setProjects([]);
          setCurrentView('dashboard');
        };

        const fetchDashboardData = async () => {
          try {
            setLoading(true);
            const result = await apiCall('/api/admin-ui/dashboard');
            setData(result.data);
            setError(null);
          } catch (err) {
            setError(err.message);
          } finally {
            setLoading(false);
          }
        };

        const fetchUsers = async () => {
          try {
            setLoading(true);
            const result = await apiCall('/api/admin-ui/users?page=1&limit=10');
            setUsers(result.data);
            setError(null);
          } catch (err) {
            setError(err.message);
          } finally {
            setLoading(false);
          }
        };

        const fetchTasks = async () => {
          try {
            setLoading(true);
            const result = await apiCall('/api/admin-ui/tasks?page=1&limit=10');
            setTasks(result.data);
            setError(null);
          } catch (err) {
            setError(err.message);
          } finally {
            setLoading(false);
          }
        };

        const fetchProjects = async () => {
          try {
            setLoading(true);
            const result = await apiCall(
              '/api/admin-ui/projects?page=1&limit=10',
            );
            setProjects(result.data);
            setError(null);
          } catch (err) {
            setError(err.message);
          } finally {
            setLoading(false);
          }
        };

        const handleViewChange = async (view) => {
          setCurrentView(view);
          switch (view) {
            case 'users':
              await fetchUsers();
              break;
            case 'tasks':
              await fetchTasks();
              break;
            case 'projects':
              await fetchProjects();
              break;
            case 'dashboard':
              await fetchDashboardData();
              break;
          }
        };

        if (!isAuthenticated) {
          return (
            <div className="min-h-screen flex items-center justify-center p-4">
              <div className="glass rounded-2xl p-8 w-full max-w-md">
                <div className="text-center mb-8">
                  <i className="fas fa-shield-alt text-4xl text-white mb-4"></i>
                  <h1 className="text-2xl font-bold text-white mb-2">
                    Admin Login
                  </h1>
                  <p className="text-blue-100">Access the admin dashboard</p>
                </div>

                {error && (
                  <div className="bg-red-500 bg-opacity-20 border border-red-400 text-red-100 px-4 py-3 rounded mb-4">
                    {error}
                  </div>
                )}

                <div className="space-y-4">
                  <div>
                    <input
                      type="email"
                      placeholder="Email"
                      value={loginForm.email}
                      onChange={(e) =>
                        setLoginForm({ ...loginForm, email: e.target.value })
                      }
                      className="w-full px-4 py-3 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:border-white focus:border-opacity-50"
                    />
                  </div>
                  <div>
                    <input
                      type="password"
                      placeholder="Password"
                      value={loginForm.password}
                      onChange={(e) =>
                        setLoginForm({ ...loginForm, password: e.target.value })
                      }
                      className="w-full px-4 py-3 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:border-white focus:border-opacity-50"
                      onKeyPress={(e) => e.key === 'Enter' && login()}
                    />
                  </div>
                  <button
                    onClick={login}
                    className="w-full bg-white text-blue-600 py-3 rounded-lg font-semibold hover:bg-opacity-90 transition-all duration-200 transform hover:scale-105"
                  >
                    Sign In
                  </button>
                </div>

                <div className="mt-6 text-center">
                  <p className="text-blue-100 text-sm">
                    Default: admin@taskmanagement.com / admin123
                  </p>
                </div>
              </div>
            </div>
          );
        }

        if (loading) {
          return (
            <div className="min-h-screen flex items-center justify-center">
              <div className="glass rounded-2xl p-8">
                <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto"></div>
                <p className="text-white text-center mt-4">Loading...</p>
              </div>
            </div>
          );
        }

        return (
          <div className="min-h-screen">
            {/* Header */}
            <header className="glass border-b border-white border-opacity-20">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div className="flex justify-between items-center py-4">
                  <div className="flex items-center">
                    <i className="fas fa-tasks text-2xl text-white mr-3"></i>
                    <h1 className="text-2xl font-bold text-white">
                      Admin Dashboard
                    </h1>
                  </div>
                  <div className="flex items-center space-x-4">
                    <div className="flex items-center space-x-2">
                      <div
                        className={`w-3 h-3 rounded-full ${data?.systemHealth?.status === 'healthy' ? 'bg-green-400' : 'bg-red-400'}`}
                      ></div>
                      <span className="text-white text-sm">
                        {data?.systemHealth?.status}
                      </span>
                    </div>
                    <span className="text-blue-100">
                      {data?.user?.fullName || data?.user?.email}
                    </span>
                    <button
                      onClick={logout}
                      className="bg-white bg-opacity-20 text-white px-3 py-1 rounded hover:bg-opacity-30 transition"
                    >
                      <i className="fas fa-sign-out-alt"></i>
                    </button>
                  </div>
                </div>
              </div>
            </header>

            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              {/* Navigation */}
              <div className="glass rounded-lg p-1 mb-8 inline-flex">
                {['dashboard', 'users', 'tasks', 'projects'].map((view) => (
                  <button
                    key={view}
                    onClick={() => handleViewChange(view)}
                    className={`px-6 py-2 rounded-md capitalize transition ${
                      currentView === view
                        ? 'bg-white text-blue-600 shadow-lg'
                        : 'text-white hover:bg-white hover:bg-opacity-10'
                    }`}
                  >
                    <i
                      className={`fas ${
                        view === 'dashboard'
                          ? 'fa-chart-pie'
                          : view === 'users'
                            ? 'fa-users'
                            : view === 'tasks'
                              ? 'fa-tasks'
                              : 'fa-folder'
                      } mr-2`}
                    ></i>
                    {view}
                  </button>
                ))}
              </div>

              {error && (
                <div className="bg-red-500 bg-opacity-20 border border-red-400 text-red-100 px-4 py-3 rounded-lg mb-6">
                  <i className="fas fa-exclamation-triangle mr-2"></i>
                  {error}
                </div>
              )}

              {/* Dashboard View */}
              {currentView === 'dashboard' && data && (
                <div>
                  {/* Stats Grid */}
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div className="glass rounded-xl p-6">
                      <div className="flex items-center">
                        <div className="flex-shrink-0">
                          <div className="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center">
                            <i className="fas fa-users text-white text-xl"></i>
                          </div>
                        </div>
                        <div className="ml-4">
                          <p className="text-blue-100 text-sm">Total Users</p>
                          <p className="text-2xl font-bold text-white">
                            {data.stats?.users?.total || 0}
                          </p>
                          <p className="text-green-300 text-xs">
                            {data.stats?.users?.active || 0} active
                          </p>
                        </div>
                      </div>
                    </div>

                    <div className="glass rounded-xl p-6">
                      <div className="flex items-center">
                        <div className="flex-shrink-0">
                          <div className="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center">
                            <i className="fas fa-tasks text-white text-xl"></i>
                          </div>
                        </div>
                        <div className="ml-4">
                          <p className="text-blue-100 text-sm">Total Tasks</p>
                          <p className="text-2xl font-bold text-white">
                            {data.stats?.tasks?.total || 0}
                          </p>
                          <p className="text-blue-200 text-xs">All statuses</p>
                        </div>
                      </div>
                    </div>

                    <div className="glass rounded-xl p-6">
                      <div className="flex items-center">
                        <div className="flex-shrink-0">
                          <div className="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center">
                            <i className="fas fa-folder text-white text-xl"></i>
                          </div>
                        </div>
                        <div className="ml-4">
                          <p className="text-blue-100 text-sm">
                            Total Projects
                          </p>
                          <p className="text-2xl font-bold text-white">
                            {data.stats?.projects?.total || 0}
                          </p>
                          <p className="text-purple-200 text-xs">
                            Active projects
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* System Info */}
                  <div className="glass rounded-xl p-6">
                    <h3 className="text-xl font-semibold text-white mb-4">
                      <i className="fas fa-server mr-2"></i>
                      System Information
                    </h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <h4 className="text-sm font-medium text-blue-100 mb-2">
                          Status
                        </h4>
                        <p
                          className={`text-sm font-semibold ${data.systemHealth?.status === 'healthy' ? 'text-green-300' : 'text-red-300'}`}
                        >
                          <i
                            className={`fas ${data.systemHealth?.status === 'healthy' ? 'fa-check-circle' : 'fa-times-circle'} mr-1`}
                          ></i>
                          {data.systemHealth?.status?.toUpperCase()}
                        </p>
                      </div>
                      <div>
                        <h4 className="text-sm font-medium text-blue-100 mb-2">
                          Uptime
                        </h4>
                        <p className="text-sm text-white">
                          <i className="fas fa-clock mr-1"></i>
                          {data.systemHealth?.uptime
                            ? Math.floor(data.systemHealth.uptime / 3600) +
                              ' hours'
                            : 'N/A'}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Users View */}
              {currentView === 'users' && (
                <div className="glass rounded-xl p-6">
                  <h3 className="text-xl font-semibold text-white mb-4">
                    <i className="fas fa-users mr-2"></i>
                    User Management
                  </h3>
                  <div className="overflow-x-auto">
                    <table className="min-w-full">
                      <thead>
                        <tr className="border-b border-white border-opacity-20">
                          <th className="text-left py-3 px-4 text-blue-100">
                            Name
                          </th>
                          <th className="text-left py-3 px-4 text-blue-100">
                            Email
                          </th>
                          <th className="text-left py-3 px-4 text-blue-100">
                            Role
                          </th>
                          <th className="text-left py-3 px-4 text-blue-100">
                            Status
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        {users.map((user) => (
                          <tr
                            key={user.id}
                            className="border-b border-white border-opacity-10"
                          >
                            <td className="py-3 px-4 text-white">
                              {user.firstName} {user.lastName}
                            </td>
                            <td className="py-3 px-4 text-blue-100">
                              {user.email}
                            </td>
                            <td className="py-3 px-4">
                              <span className="bg-blue-500 bg-opacity-30 text-blue-100 px-2 py-1 rounded text-xs">
                                {user.role}
                              </span>
                            </td>
                            <td className="py-3 px-4">
                              <span
                                className={`px-2 py-1 rounded text-xs ${
                                  user.isActive
                                    ? 'bg-green-500 bg-opacity-30 text-green-100'
                                    : 'bg-red-500 bg-opacity-30 text-red-100'
                                }`}
                              >
                                {user.isActive ? 'Active' : 'Inactive'}
                              </span>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              )}

              {/* Tasks View */}
              {currentView === 'tasks' && (
                <div className="glass rounded-xl p-6">
                  <h3 className="text-xl font-semibold text-white mb-4">
                    <i className="fas fa-tasks mr-2"></i>
                    Task Management
                  </h3>
                  <div className="grid gap-4">
                    {tasks.map((task) => (
                      <div
                        key={task.id}
                        className="bg-white bg-opacity-10 rounded-lg p-4"
                      >
                        <div className="flex justify-between items-start">
                          <div>
                            <h4 className="text-white font-semibold">
                              {task.title}
                            </h4>
                            <p className="text-blue-100 text-sm mt-1">
                              {task.description}
                            </p>
                          </div>
                          <div className="flex space-x-2">
                            <span
                              className={`px-2 py-1 rounded text-xs ${
                                task.priority === 'high'
                                  ? 'bg-red-500 bg-opacity-30 text-red-100'
                                  : task.priority === 'medium'
                                    ? 'bg-yellow-500 bg-opacity-30 text-yellow-100'
                                    : 'bg-green-500 bg-opacity-30 text-green-100'
                              }`}
                            >
                              {task.priority}
                            </span>
                            <span className="bg-blue-500 bg-opacity-30 text-blue-100 px-2 py-1 rounded text-xs">
                              {task.status}
                            </span>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Projects View */}
              {currentView === 'projects' && (
                <div className="glass rounded-xl p-6">
                  <h3 className="text-xl font-semibold text-white mb-4">
                    <i className="fas fa-folder mr-2"></i>
                    Project Management
                  </h3>
                  <div className="grid gap-4">
                    {projects.map((project) => (
                      <div
                        key={project.id}
                        className="bg-white bg-opacity-10 rounded-lg p-4"
                      >
                        <div className="flex justify-between items-start">
                          <div>
                            <h4 className="text-white font-semibold">
                              {project.name}
                            </h4>
                            <p className="text-blue-100 text-sm mt-1">
                              {project.description}
                            </p>
                          </div>
                          <span className="bg-purple-500 bg-opacity-30 text-purple-100 px-2 py-1 rounded text-xs">
                            {project.status}
                          </span>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Quick Links */}
              <div className="mt-8 glass rounded-xl p-6">
                <h3 className="text-lg font-semibold text-white mb-4">
                  Quick Links
                </h3>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <button
                    onClick={() => window.open('/api/docs', '_blank')}
                    className="bg-white bg-opacity-10 hover:bg-opacity-20 text-white p-4 rounded-lg transition text-center"
                  >
                    <i className="fas fa-book text-2xl mb-2 block"></i>
                    API Docs
                  </button>
                  <button
                    onClick={() => window.open('/health', '_blank')}
                    className="bg-white bg-opacity-10 hover:bg-opacity-20 text-white p-4 rounded-lg transition text-center"
                  >
                    <i className="fas fa-heartbeat text-2xl mb-2 block"></i>
                    Health Check
                  </button>
                  <button
                    onClick={() => handleViewChange('dashboard')}
                    className="bg-white bg-opacity-10 hover:bg-opacity-20 text-white p-4 rounded-lg transition text-center"
                  >
                    <i className="fas fa-sync text-2xl mb-2 block"></i>
                    Refresh Data
                  </button>
                  <button
                    onClick={() => window.open('/admin/queues', '_blank')}
                    className="bg-white bg-opacity-10 hover:bg-opacity-20 text-white p-4 rounded-lg transition text-center"
                  >
                    <i className="fas fa-list text-2xl mb-2 block"></i>
                    Queue Monitor
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      ReactDOM.render(<AdminDashboard />, document.getElementById('root'));
    </script>
  </body>
</html>
